#
# Copyright (C) 2017 Red Hat, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#         http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

version: '{build}'
init:
- ps: "Add-Type -AssemblyName System.IO.Compression.FileSystem\nif (!(Test-Path -Path \"C:\\apache-maven\" )) {\n        Write-Host \"Downloading Maven $env:MAVEN_VERSION\"\n        (new-object System.Net.WebClient).DownloadFile(\"https://repo1.maven.org/maven2/org/apache/maven/apache-maven/$env:MAVEN_VERSION/apache-maven-$env:MAVEN_VERSION-bin.zip\", \"C:\\apache-maven-$env:MAVEN_VERSION-bin.zip\") \n        [System.IO.Compression.ZipFile]::ExtractToDirectory(\"C:\\apache-maven-$env:MAVEN_VERSION-bin.zip\", \"C:\\apache-maven\")\n      }"
environment:
  MAVEN_VERSION: 3.6.1
  matrix:
  - JAVA_HOME: C:\Program Files\Java\jdk1.8.0
install:
- cmd: >-
    choco install codecov

    choco upgrade codecov

    SET M2_HOME=C:\apache-maven\apache-maven-%MAVEN_VERSION%

    SET PATH=%M2_HOME%\bin;%JAVA_HOME%\bin;%PATH%

    mvn --version
cache:
- C:\apache-maven -> appveyor.yml
- C:\Users\appveyor\.m2 -> pom.xml
- C:\ProgramData\chocolatey
build_script:
- ps: mvn -B clean install
on_success:
- ps: codecov -f target/site/jacoco/jacoco.xml
